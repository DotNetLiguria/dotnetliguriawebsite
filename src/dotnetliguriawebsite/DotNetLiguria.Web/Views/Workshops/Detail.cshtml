@model DotNetLiguria.ViewModels.WorkshopViewModels

@{
    ViewBag.Title = "Detail";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- CSS Page Style -->
<link rel="stylesheet" href="~/Content/Unify/css/pages/shortcode_timeline2.css">
<link rel="stylesheet" href="~/Content/Unify/css/pages/profile.css">
<link rel="stylesheet" href="~/Content/Unify/plugins/fancybox/source/jquery.fancybox.css">   

<div class="breadcrumbs">
    <div class="container">
        <h1 class="pull-left">@Model.Workshop.Title</h1>
        <ul class="pull-right breadcrumb">
            <li><a href="@Url.Action("Index", "Home")">Home</a></li>
            <li><a href="@Url.Action("Index", "Workshops")">Workshops</a></li>
            <li class="active">@Model.Workshop.Title</li>
        </ul>
    </div><!--/container-->
</div>



<div class="container content profile">
    <div class="row">

        <div class="col-md-9">
            <!--=== Profile ===-->
            <div class="profile-body">
                <div class="profile-bio">
                    <div class="row">
                        <div class="col-md-3">
                            <img class="img-responsive md-margin-bottom-10" src="@Model.Workshop.Image" alt="">
                        </div>
                        <div class="col-md-9">
                            <h2>@Model.Workshop.Title</h2>
                            <h4><i class="fa fa-clock-o"></i> @Model.Workshop.EventDate.ToString("dd MMMM yyyy")</h4>
                            <h4><i class="icon-home"></i> @Model.Workshop.Location.Name</h4>
                            <h4><i class="icon-map"></i> @Model.Workshop.Location.Address</h4>
                            <hr>
                            <p>@Model.Workshop.Description</p>
                        </div>
                    </div>
                </div><!--/end row-->

                <hr>

                @if (Model.Workshop.IsExternalEvent)
                {
                    @Html.Raw(Model.Workshop.BlogHtml)
                }
                else
                {
                <!--Timeline-->
                    <div class="panel panel-profile">
                        <div class="panel-heading overflow-h">
                            <h2 class="panel-title heading-sm pull-left"><i class="fa fa-mortar-board"></i> Tracks</h2>
                            @*<a href="#"><i class="fa fa-cog pull-right"></i></a>*@
                        </div>
                        <div class="panel-body">
                            <ul class="timeline-v2 timeline-me">
                                @foreach (var track in Model.Workshop.Tracks.OrderBy(x => x.StartTime))
                                {
                                    var speaker = "";

                                    if (track.Speakers.Count > 0)
                                    {
                                        foreach (var item in track.Speakers)
                                        {
                                            speaker += item.Name + ", ";
                                        }
                                        speaker = speaker.Remove(speaker.Length - 2);
                                    }

                                    <li class="margin-bottom-40">
                                        <time datetime="" class="cbp_tmtime"><span>@speaker</span> <span>@track.StartTime.TimeOfDay - @track.EndTime.TimeOfDay</span></time>
                                        <i class="cbp_tmicon rounded-x hidden-xs"></i>
                                        <div class="cbp_tmlabel">
                                            <h2>@track.Title</h2>
                                            <p>@track.Abstract</p>
                                        </div>
                                    </li>
                                }

                            </ul>
                        </div>
                    </div>
                <!--End Timeline-->
                }

                <hr>

                @if (Model.Workshop.EventDate > DateTime.Now)
                {
                    <div class="panel panel-profile">
                        <div class="panel-heading overflow-h">
                            <h2 class="panel-title heading-sm pull-left"><i class="icon-map"></i> Location</h2>
                        </div>

                        <iframe width="100%"
                                height="450"
                                frameborder="0" style="border:0"
                                src="https://www.google.com/maps/embed/v1/place?key=AIzaSyBXYaqwHgEikamnsJBlWZ3xx19AfVB45gA&q=@Model.Workshop.Location.Coordinates" allowfullscreen></iframe>

                        <ul class="list-unstyled who margin-bottom-30">
                            <li><a href="#"><i class="fa fa-home"></i>@Model.Workshop.Location.Address</a></li>
                        </ul>

                        <!-- Google Map -->
                        @*<div id="map" class="map map-box map-box-space1 margin-bottom-20">
                        </div><!---/map-->
                        <!-- End Google Map -->



                        <hr />

                        <div id="panorama" class="map margin-bottom-40"></div>*@
                    </div>
                }
                else
                {

                    <br />
                    @Html.Partial("_PhotoSlider")
                }

            </div>
            <!--=== End Profile ===-->
        </div>


        <div class="col-md-3">
            @Html.Partial("_Action")
        </div>

    </div>
</div>

<script type="text/javascript" src="~/Content/Unify/plugins/fancybox/source/jquery.fancybox.pack.js"></script>
@*<script type="text/javascript" src="https://maps.google.com/maps/api/js?key=AIzaSyBXYaqwHgEikamnsJBlWZ3xx19AfVB45gA"></script>
<script type="text/javascript" src="~/Content/Unify/plugins/gmap/gmap.js"></script>*@
<script type="text/javascript" src="~/Content/Unify/js/plugins/fancy-box.js"></script>

<script type="text/javascript">

    jQuery(document).ready(function() {
        FancyBox.initFancybox();
    });

    @*jQuery(document).ready(function () {
        var map;
        $(document).ready(function(){
            map = new GMaps({
                div: '#map',
                scrollwheel: false,
                lat: @Model.Workshop.Location.Coordinates.Split(',')[0],
                lng: @Model.Workshop.Location.Coordinates.Split(',')[1],
            });

            var marker = map.addMarker({
                lat: @Model.Workshop.Location.Coordinates.Split(',')[0],
                lng: @Model.Workshop.Location.Coordinates.Split(',')[1],
                title: "@Model.Workshop.Location.Name"
            });

            var panorama;
            $(document).ready(function(){
                panorama = GMaps.createPanorama({
                    el: '#panorama',
                    lat : @Model.Workshop.Location.Coordinates.Split(',')[0],
                    lng : @Model.Workshop.Location.Coordinates.Split(',')[1],
                });
            });
        });*@
    });
</script>


<div class="modal fade" id="addFeedback" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
                <h4 id="myModalLabel1" class="modal-title">Add Feedback</h4>
            </div>

            <div class="modal-body">
                @Html.Partial("_Feedback", GetFeedback())
            </div>

            <div class="modal-footer">
                <button data-dismiss="modal" class="btn btn-u btn-u-default" type="button">Close</button>
            </div>

        </div>

    </div>

    @functions{
        public DotNetLiguria.Models.WorkshopUndersigned GetFeedback()
        {
            if (User.Identity.IsAuthenticated)
            {
                var undersigned = Model.Workshop.Workshopsubscribed.Where(x => x.User.Email.Equals(User.Identity.Name)).FirstOrDefault();

                if (undersigned != null) return undersigned;
            }

            return new DotNetLiguria.Models.WorkshopUndersigned();
        }
    }
</div>
